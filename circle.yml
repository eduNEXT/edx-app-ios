general:
  branches:
    only:
      - master
      
machine:
  xcode:
    version: 9.2.0
  environment:
    XCODE_WORKSPACE: edX.xcworkspace
    XCODE_SCHEME: edX
    LC_ALL: en_US.UTF-8
    LANG: en_US.UTF-8

dependencies:
  override:
    - sudo pip install requests
    - brew update
    - brew upgrade openssl
    - brew install ruby
    - brew install imagemagick
    - brew cleanup
    - sudo gem install fastlane
    - ./gradlew dependencies --stacktrace --info
  post:
    - git clone git@github.com:proversity-org/edx-app-ios-config.git --branch proversity/wsl --single-branch ./deployment
    - cp -R deployment/assets/iTunesArtwork@2x.png iTunesArtwork@2x.png
    - cp -R deployment/assets/app_icons/ Source/Resources/Icons
    - cp -R deployment/assets/logos/ Source/Resources/Images
    - cp -R deployment/assets/splash_screens/ Source/Resources/Splash
    - cp -R deployment/assets/images/ Source/Resources/Images
    - cp -R deployment/assets/iTunesArtwork@2x.png Source/Resources/Images
    - cp -R deployment/custom_config custom_config
    - cp -R deployment/default_config/ default_config
    - cp -R deployment/fastlane fastlane
    - cp -R deployment/colors.json Source/Resources/Colors
    - cp -R deployment/config_project.py config_project.py
    - cp -R deployment/fonts.json Source/Resources/Fonts
    - cp -R deployment/setup_certificates.py setup_certificates.py
    - cp -R deployment/assets/iTunesArtwork@2x.png edX/Images.xcassets/AppIcon.appiconset
    - cp -R deployment/assets/app_icons/ edX/Images.xcassets/AppIcon.appiconset

test:
  override:
    - sleep 10

deployment:
  beta:
    branch: master
    commands:
      - python config_project.py "wsl,Leading TogetherX,2.12.2,2.12,9c822622-85fa-476c-b121-347b9ceee8d0,2c9d7439-4fd6-4ca5-8e16-a897e463a6fa"
      - fastlane beta